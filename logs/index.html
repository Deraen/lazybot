<html>
<head>

<script type="text/javascript" src="http://code.jquery.com/jquery-1.4.4.min.js"></script>
<script type="text/javascript">

base_url = "http://raynes.me/logs/irc.freenode.net/"
irc_url  = "irc://irc.freenode.net/#"
one_day  = 1000*60*60*24;
hash     = window.location.hash.split("/");
channel  = hash[0].replace("#", "");
current  = hash[1] ? new Date(hash[1].replace(/-/g, "/")) : new Date();

function prev() {
    current.setTime(current.getTime() - one_day);
    updateLog();
}

function next() {
    current.setTime(current.getTime() + one_day);
    updateLog();
}

function pad(num) {
    return (num < 10) ? '0' + num : num;
}

function updateLog() {
    $('#date').show();
    $('#channel').html('<a href="' + irc_url + channel + '">#' + channel + '</a>');

    now = (new Date()).getTime();
    if (current.getTime() > now) {
        current.setTime(now);
    }
    day = current.getFullYear() + "-" + pad(current.getMonth() + 1) + "-" + pad(current.getDate());
    $('#day').html(day);
    window.location.hash = "#" + channel + "/" + day

    url = base_url + channel + "/" + day + ".txt";
    $.get(url, function(data) {
        $('#log').html(data);
    });
}

$(document).ready(function() {
    $('#log').ajaxError(function() {
        $(this).html("[null] there are no logs available for this date");
    });
    updateLog();
});

</script>

<style type="text/css">
a { text-decoration:none }
a{color: grey;}
a:visited{color: grey;}
</style>

</head>

<body>
<code>
<h3>
<span id="channel"></span>
<span id="date">
  <a href="javascript:prev()">&lt;</a> <span id="day"></span> <a href="javascript:next()">&gt;</a>
</div>
</h3>

<pre id="log"></pre>

</code>
</body>
